{"version":3,"file":"chat-client.js","sources":["../src/chat-client.js"],"sourcesContent":["// src/chat-client.js\n// 存储自己的客户端ID\nlet myClientId = null;\n\n// 连接到聊天WebSocket服务器\nconst socket = new WebSocket('ws://192.168.23.164:8080');\n\n// DOM元素\nlet messagesContainer;\nlet messageInput;\nlet sendButton;\nlet statusElement;\n\n// 等待DOM加载完成\ndocument.addEventListener('DOMContentLoaded', () => {\n  messagesContainer = document.getElementById('messages');\n  messageInput = document.getElementById('message-input');\n  sendButton = document.getElementById('send-btn');\n  statusElement = document.querySelector('.status');\n\n  // 添加事件监听器\n  sendButton.addEventListener('click', sendMessage);\n  messageInput.addEventListener('keypress', (e) => {\n    if (e.key === 'Enter') sendMessage();\n  });\n\n  // 让输入框获得焦点\n  setTimeout(() => messageInput.focus(), 500);\n});\n\n// 连接打开时\nsocket.addEventListener('open', () => {\n  if (statusElement) {\n    statusElement.textContent = '已连接';\n    statusElement.classList.add('connected');\n  }\n});\n\n// 接收消息\nsocket.addEventListener('message', (event) => {\n  const message = JSON.parse(event.data);\n  \n  // 如果收到了系统消息且包含我们的ID，保存它\n  if (message.type === 'system' && message.id) {\n    myClientId = message.id;\n    console.log('我的客户端ID:', myClientId);\n  }\n  \n  // 添加消息到UI\n  addMessageToUI(message);\n});\n\n// 连接关闭时\nsocket.addEventListener('close', () => {\n  if (statusElement) {\n    statusElement.textContent = '已断开连接';\n    statusElement.classList.remove('connected');\n    statusElement.classList.add('disconnected');\n  }\n});\n\n// 连接错误时\nsocket.addEventListener('error', (error) => {\n  if (statusElement) {\n    statusElement.textContent = '连接错误';\n    statusElement.classList.add('error');\n  }\n  console.error('WebSocket错误:', error);\n});\n\n// 发送消息\nfunction sendMessage() {\n  if (!messageInput) return;\n  \n  const content = messageInput.value.trim();\n  if (content && socket.readyState === WebSocket.OPEN) {\n    socket.send(JSON.stringify({ content }));\n    messageInput.value = '';\n    \n    // 让输入框重新获得焦点\n    messageInput.focus();\n  }\n}\n\n// 添加消息到UI\nfunction addMessageToUI(message) {\n  if (!messagesContainer) return;\n  \n  // 创建消息容器（外层）\n  const messageContainer = document.createElement('div');\n  messageContainer.classList.add('message-container');\n  \n  // 确定消息容器类型\n  if (message.type === 'chat') {\n    if (message.from === myClientId) {\n      messageContainer.classList.add('self-container');\n    } else {\n      messageContainer.classList.add('other-container');\n    }\n  } else {\n    // 系统、加入、离开消息\n    messageContainer.classList.add(`${message.type}-container`);\n  }\n  \n  // 创建消息元素（内层）\n  const messageElement = document.createElement('div');\n  messageElement.classList.add('message');\n  \n  // 根据消息类型添加类\n  if (message.type) {\n    messageElement.classList.add(message.type);\n  }\n  \n  // 如果是聊天消息，且是自己发的，添加self类\n  if (message.type === 'chat' && message.from === myClientId) {\n    messageElement.classList.add('self');\n  }\n  \n  // 只为聊天消息显示发送者名称\n  if (message.type === 'chat') {\n    const fromElement = document.createElement('div');\n    fromElement.classList.add('from');\n    fromElement.textContent = message.from || 'Unknown';\n    messageElement.appendChild(fromElement);\n  }\n  \n  const contentElement = document.createElement('div');\n  contentElement.classList.add('content');\n  contentElement.textContent = message.content;\n  messageElement.appendChild(contentElement);\n  \n  // 为聊天消息添加时间戳\n  if (message.type === 'chat') {\n    const timeElement = document.createElement('div');\n    timeElement.classList.add('time');\n    timeElement.textContent = message.timestamp \n      ? new Date(message.timestamp).toLocaleTimeString() \n      : new Date().toLocaleTimeString();\n    messageElement.appendChild(timeElement);\n  }\n  \n  // 将消息元素添加到容器中\n  messageContainer.appendChild(messageElement);\n  \n  // 将容器添加到消息区域\n  messagesContainer.appendChild(messageContainer);\n  \n  // 滚动到最新消息\n  messagesContainer.scrollTop = messagesContainer.scrollHeight;\n}"],"names":[],"mappings":"AAAA;AACA;AACA,IAAI,UAAU,GAAG,IAAI;;AAErB;AACA,MAAM,MAAM,GAAG,IAAI,SAAS,CAAC,0BAA0B,CAAC;;AAExD;AACA,IAAI,iBAAiB;AACrB,IAAI,YAAY;AAChB,IAAI,UAAU;AACd,IAAI,aAAa;;AAEjB;AACA,QAAQ,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,MAAM;AACpD,EAAE,iBAAiB,GAAG,QAAQ,CAAC,cAAc,CAAC,UAAU,CAAC;AACzD,EAAE,YAAY,GAAG,QAAQ,CAAC,cAAc,CAAC,eAAe,CAAC;AACzD,EAAE,UAAU,GAAG,QAAQ,CAAC,cAAc,CAAC,UAAU,CAAC;AAClD,EAAE,aAAa,GAAG,QAAQ,CAAC,aAAa,CAAC,SAAS,CAAC;;AAEnD;AACA,EAAE,UAAU,CAAC,gBAAgB,CAAC,OAAO,EAAE,WAAW,CAAC;AACnD,EAAE,YAAY,CAAC,gBAAgB,CAAC,UAAU,EAAE,CAAC,CAAC,KAAK;AACnD,IAAI,IAAI,CAAC,CAAC,GAAG,KAAK,OAAO,EAAE,WAAW,EAAE;AACxC,GAAG,CAAC;;AAEJ;AACA,EAAE,UAAU,CAAC,MAAM,YAAY,CAAC,KAAK,EAAE,EAAE,GAAG,CAAC;AAC7C,CAAC,CAAC;;AAEF;AACA,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE,MAAM;AACtC,EAAE,IAAI,aAAa,EAAE;AACrB,IAAI,aAAa,CAAC,WAAW,GAAG,KAAK;AACrC,IAAI,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,WAAW,CAAC;AAC5C;AACA,CAAC,CAAC;;AAEF;AACA,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAC,KAAK,KAAK;AAC9C,EAAE,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC;AACxC;AACA;AACA,EAAE,IAAI,OAAO,CAAC,IAAI,KAAK,QAAQ,IAAI,OAAO,CAAC,EAAE,EAAE;AAC/C,IAAI,UAAU,GAAG,OAAO,CAAC,EAAE;AAC3B,IAAI,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,UAAU,CAAC;AACvC;AACA;AACA;AACA,EAAE,cAAc,CAAC,OAAO,CAAC;AACzB,CAAC,CAAC;;AAEF;AACA,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,MAAM;AACvC,EAAE,IAAI,aAAa,EAAE;AACrB,IAAI,aAAa,CAAC,WAAW,GAAG,OAAO;AACvC,IAAI,aAAa,CAAC,SAAS,CAAC,MAAM,CAAC,WAAW,CAAC;AAC/C,IAAI,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,cAAc,CAAC;AAC/C;AACA,CAAC,CAAC;;AAEF;AACA,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,KAAK,KAAK;AAC5C,EAAE,IAAI,aAAa,EAAE;AACrB,IAAI,aAAa,CAAC,WAAW,GAAG,MAAM;AACtC,IAAI,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC;AACxC;AACA,EAAE,OAAO,CAAC,KAAK,CAAC,cAAc,EAAE,KAAK,CAAC;AACtC,CAAC,CAAC;;AAEF;AACA,SAAS,WAAW,GAAG;AACvB,EAAE,IAAI,CAAC,YAAY,EAAE;AACrB;AACA,EAAE,MAAM,OAAO,GAAG,YAAY,CAAC,KAAK,CAAC,IAAI,EAAE;AAC3C,EAAE,IAAI,OAAO,IAAI,MAAM,CAAC,UAAU,KAAK,SAAS,CAAC,IAAI,EAAE;AACvD,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC;AAC5C,IAAI,YAAY,CAAC,KAAK,GAAG,EAAE;AAC3B;AACA;AACA,IAAI,YAAY,CAAC,KAAK,EAAE;AACxB;AACA;;AAEA;AACA,SAAS,cAAc,CAAC,OAAO,EAAE;AACjC,EAAE,IAAI,CAAC,iBAAiB,EAAE;AAC1B;AACA;AACA,EAAE,MAAM,gBAAgB,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC;AACxD,EAAE,gBAAgB,CAAC,SAAS,CAAC,GAAG,CAAC,mBAAmB,CAAC;AACrD;AACA;AACA,EAAE,IAAI,OAAO,CAAC,IAAI,KAAK,MAAM,EAAE;AAC/B,IAAI,IAAI,OAAO,CAAC,IAAI,KAAK,UAAU,EAAE;AACrC,MAAM,gBAAgB,CAAC,SAAS,CAAC,GAAG,CAAC,gBAAgB,CAAC;AACtD,KAAK,MAAM;AACX,MAAM,gBAAgB,CAAC,SAAS,CAAC,GAAG,CAAC,iBAAiB,CAAC;AACvD;AACA,GAAG,MAAM;AACT;AACA,IAAI,gBAAgB,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,EAAE,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AAC/D;AACA;AACA;AACA,EAAE,MAAM,cAAc,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC;AACtD,EAAE,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC;AACzC;AACA;AACA,EAAE,IAAI,OAAO,CAAC,IAAI,EAAE;AACpB,IAAI,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC;AAC9C;AACA;AACA;AACA,EAAE,IAAI,OAAO,CAAC,IAAI,KAAK,MAAM,IAAI,OAAO,CAAC,IAAI,KAAK,UAAU,EAAE;AAC9D,IAAI,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC;AACxC;AACA;AACA;AACA,EAAE,IAAI,OAAO,CAAC,IAAI,KAAK,MAAM,EAAE;AAC/B,IAAI,MAAM,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC;AACrD,IAAI,WAAW,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC;AACrC,IAAI,WAAW,CAAC,WAAW,GAAG,OAAO,CAAC,IAAI,IAAI,SAAS;AACvD,IAAI,cAAc,CAAC,WAAW,CAAC,WAAW,CAAC;AAC3C;AACA;AACA,EAAE,MAAM,cAAc,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC;AACtD,EAAE,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC;AACzC,EAAE,cAAc,CAAC,WAAW,GAAG,OAAO,CAAC,OAAO;AAC9C,EAAE,cAAc,CAAC,WAAW,CAAC,cAAc,CAAC;AAC5C;AACA;AACA,EAAE,IAAI,OAAO,CAAC,IAAI,KAAK,MAAM,EAAE;AAC/B,IAAI,MAAM,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC;AACrD,IAAI,WAAW,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC;AACrC,IAAI,WAAW,CAAC,WAAW,GAAG,OAAO,CAAC,SAAS;AAC/C,QAAQ,IAAI,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,kBAAkB,EAAE;AACxD,QAAQ,IAAI,IAAI,EAAE,CAAC,kBAAkB,EAAE;AACvC,IAAI,cAAc,CAAC,WAAW,CAAC,WAAW,CAAC;AAC3C;AACA;AACA;AACA,EAAE,gBAAgB,CAAC,WAAW,CAAC,cAAc,CAAC;AAC9C;AACA;AACA,EAAE,iBAAiB,CAAC,WAAW,CAAC,gBAAgB,CAAC;AACjD;AACA;AACA,EAAE,iBAAiB,CAAC,SAAS,GAAG,iBAAiB,CAAC,YAAY;AAC9D"}